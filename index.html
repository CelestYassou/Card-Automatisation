<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flashcards & Quiz - Étude Interactive</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary-color: #4a6fa5;
      --secondary-color: #166088;
      --accent-color: #4fc3f7;
      --text-color: #333;
      --light-color: #f8f9fa;
      --dark-color: #343a40;
      --success-color: #28a745;
      --error-color: #dc3545;
      --shadow-color: rgba(0, 0, 0, 0.1);
      --transition-speed: 0.3s;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--light-color);
      color: var(--text-color);
      line-height: 1.6;
      padding: 0;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: background-color var(--transition-speed), color var(--transition-speed);
    }

    body.dark-mode {
      --light-color: #212529;
      --dark-color: #f8f9fa;
      --text-color: #f8f9fa;
      --primary-color: #343a40;
      --secondary-color: #23272b;
      --accent-color: #17a2b8;
      --shadow-color: rgba(255, 255, 255, 0.1);
      background-color: var(--dark-color);
      color: var(--text-color);
    }

    .container {
      max-width: 1200px;
      width: 95%;
      margin: 30px auto;
      padding: 30px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px var(--shadow-color);
      transition: transform var(--transition-speed), background-color var(--transition-speed);
      animation: fadeIn 1s;
    }

    body.dark-mode .container {
      background-color: var(--light-color);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1, h2 {
      text-align: center;
      color: var(--dark-color);
      margin-bottom: 20px;
      font-weight: 600;
    }

    body.dark-mode h1, body.dark-mode h2 {
      color: var(--text-color);
    }

    textarea {
      width: 100%;
      height: 180px;
      padding: 15px;
      margin-bottom: 20px;
      border: 1.5px solid #ddd;
      border-radius: 8px;
      resize: vertical;
      font-family: inherit;
      font-size: 15px;
      transition: border-color var(--transition-speed), background-color var(--transition-speed), color var(--transition-speed);
      box-shadow: 0 4px 6px var(--shadow-color);
      background-color: var(--light-color);
      color: var(--text-color);
    }

    body.dark-mode textarea {
      background-color: var(--dark-color);
      color: var(--text-color);
      border-color: var(--primary-color);
    }

    textarea:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 6px 12px rgba(74, 111, 165, 0.3);
    }

    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 12px 25px;
      margin: 5px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;
      transition: all var(--transition-speed);
      box-shadow: 0 4px 10px var(--shadow-color);
    }

    button:hover {
      background-color: var(--secondary-color);
      transform: translateY(-3px);
      box-shadow: 0 8px 15px rgba(22, 96, 136, 0.3);
    }

    button:active {
      transform: translateY(1px);
    }

    .dashboard {
      display: flex;
      justify-content: space-around;
      gap: 30px;
      margin-top: 25px;
      flex-wrap: wrap;
    }

    .card {
      background: linear-gradient(145deg, var(--light-color), #e2e6ea);
      border-radius: 12px;
      box-shadow: 0 8px 20px var(--shadow-color);
      padding: 30px;
      width: 300px;
      text-align: center;
      transition: transform var(--transition-speed), box-shadow var(--transition-speed), background-color var(--transition-speed);
      animation: fadeIn 1s;
    }

    body.dark-mode .card {
      background: linear-gradient(145deg, var(--dark-color), #212529);
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 25px var(--shadow-color);
    }

    .fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      padding: 20px;
      box-sizing: border-box;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
      animation: fadeIn 0.5s;
      transition: background-color var(--transition-speed);
    }

    body.dark-mode .fullscreen {
      background: linear-gradient(135deg, var(--dark-color) 0%, var(--light-color) 100%);
    }

    .close-button {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.8);
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--dark-color);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 2px 10px var(--shadow-color);
      transition: background var(--transition-speed);
    }

    body.dark-mode .close-button {
      background: rgba(0, 0, 0, 0.8);
      color: var(--text-color);
    }

    .close-button:hover {
      background: rgba(255, 255, 255, 1);
    }

    body.dark-mode .close-button:hover {
      background: rgba(0, 0, 0, 1);
    }

    .flashcard-container {
      background-color: white;
      padding: 30px;
      border-radius: 15px;
      width: 100%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 15px 30px var(--shadow-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      animation: slideIn 0.5s;
      transition: background-color var(--transition-speed);
    }

    body.dark-mode .flashcard-container {
      background-color: var(--light-color);
    }

    @keyframes slideIn {
      from { transform: translateX(-20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .flashcard {
      width: 100%;
      height: 300px;
      perspective: 1500px;
      margin: 25px 0;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 10px 20px var(--shadow-color);
      border-radius: 12px;
      transition: transform 0.8s;
    }

    .flashcard-inner {
      position: relative;
      width: 100%;
      height: 100%;
      text-align: center;
      transition: transform 0.8s;
      transform-style: preserve-3d;
      border-radius: 12px;
      background-color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      font-size: 1.5rem;
      line-height: 1.5;
      font-weight: 600;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      transition: background-color var(--transition-speed), color var(--transition-speed);
    }

    body.dark-mode .flashcard-inner {
      background-color: var(--dark-color);
      color: var(--text-color);
    }

    .flashcard.flipped .flashcard-inner {
      transform: rotateY(180deg);
    }

    .flashcard-front, .flashcard-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 25px;
      box-sizing: border-box;
      word-wrap: break-word;
      text-align: center;
      transition: background-color var(--transition-speed), color var(--transition-speed);
    }

    .flashcard-front {
      background-color: white;
      font-size: 1.6rem;
      color: var(--dark-color);
    }

    body.dark-mode .flashcard-front {
      background-color: var(--dark-color);
      color: var(--text-color);
    }

    .flashcard-back {
      background-color: var(--light-color);
      transform: rotateY(180deg);
      font-size: 1.4rem;
      color: var(--primary-color);
    }

    body.dark-mode .flashcard-back {
      background-color: var(--dark-color);
      color: var(--text-color);
    }

    .progress-container {
      width: 100%;
      background-color: #e9ecef;
      border-radius: 10px;
      margin: 20px 0;
      height: 20px;
      box-shadow: inset 0 1px 3px var(--shadow-color);
      transition: background-color var(--transition-speed);
    }

    body.dark-mode .progress-container {
      background-color: var(--primary-color);
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-color), var(--primary-color));
      border-radius: 10px;
      width: 0%;
      transition: width 0.5s ease-in-out;
      box-shadow: 0 2px 5px rgba(79, 195, 247, 0.5);
    }

    .button-group {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    #quiz-options {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
    }

    .quiz-option {
      background-color: var(--light-color);
      border: 2px solid var(--primary-color);
      border-radius: 8px;
      padding: 15px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all var(--transition-speed);
      user-select: none;
      box-shadow: 0 4px 6px var(--shadow-color);
      transition: background-color var(--transition-speed), color var(--transition-speed);
    }

    body.dark-mode .quiz-option {
      background-color: var(--dark-color);
      color: var(--text-color);
    }

    .quiz-option:hover {
      background-color: var(--primary-color);
      color: white;
      transform: translateY(-2px);
    }

    body.dark-mode .quiz-option:hover {
      background-color: var(--secondary-color);
    }

    .quiz-option.correct {
      background-color: var(--success-color);
      border-color: var(--success-color);
      color: white;
      cursor: default;
    }

    .quiz-option.incorrect {
      background-color: var(--error-color);
      border-color: var(--error-color);
      color: white;
      cursor: default;
    }

    .hidden {
      display: none !important;
    }

    .result-message {
      font-weight: 700;
      font-size: 1.4rem;
      margin-top: 20px;
      text-align: center;
      color: var(--dark-color);
      transition: color var(--transition-speed);
    }

    body.dark-mode .result-message {
      color: var(--text-color);
    }

    .stats {
      margin-top: 20px;
      font-size: 1.2rem;
      color: var(--dark-color);
      text-align: center;
      transition: color var(--transition-speed);
    }

    body.dark-mode .stats {
      color: var(--text-color);
    }

    .chart-container {
      width: 100%;
      max-width: 400px;
      margin: 20px auto;
    }

    .chart-container canvas {
      box-shadow: 0 8px 15px var(--shadow-color);
      border-radius: 10px;
    }

    .share-button {
      background-color: var(--success-color);
      margin-top: 20px;
    }

    .share-button:hover {
      background-color: #218838;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 10001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
      background-color: #fefefe;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 500px;
      border-radius: 10px;
      box-shadow: 0 10px 20px var(--shadow-color);
      animation: fadeIn 0.5s;
      transition: background-color var(--transition-speed), color var(--transition-speed);
    }

    body.dark-mode .modal-content {
      background-color: var(--light-color);
      color: var(--text-color);
    }

    .close-modal {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close-modal:hover,
    .close-modal:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }

    body.dark-mode .close-modal:hover, body.dark-mode .close-modal:focus {
      color: var(--text-color);
    }

    .share-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
    }

    .share-options a {
      display: block;
      padding: 10px;
      background-color: var(--primary-color);
      color: white;
      text-align: center;
      border-radius: 5px;
      text-decoration: none;
      transition: background-color var(--transition-speed);
    }

    .share-options a:hover {
      background-color: var(--secondary-color);
    }

    .dark-mode-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
    }

    .dark-mode-toggle button {
      background-color: var(--dark-color);
      color: var(--light-color);
    }
  </style>
</head>
<body>
  <div class="dark-mode-toggle">
    <button onclick="toggleDarkMode()">Mode Sombre</button>
  </div>
  <div class="container">
    <h1>Flashcards & Quiz Interactif</h1>
    <textarea id="json-input" placeholder="Collez ici votre JSON..."></textarea>
    <button onclick="startSession()">Commencer la session</button>
    <button class="share-button" onclick="showShareModal()">➦</button>
    <div id="dashboard" class="dashboard hidden">
      <div class="card">
        <h2>Flashcards</h2>
        <button onclick="showFlashcards()">Commencer</button>
        <div class="stats" id="flashcard-stats"></div>
        <div class="chart-container">
          <canvas id="flashcardChart"></canvas>
        </div>
      </div>
      <div class="card">
        <h2>Quiz</h2>
        <button onclick="showQuiz()">Commencer</button>
        <div class="stats" id="quiz-stats"></div>
        <div class="chart-container">
          <canvas id="quizChart"></canvas>
        </div>
      </div>
    </div>
    <div id="flashcards-fullscreen" class="fullscreen hidden" aria-label="Flashcards mode">
      <button class="close-button" onclick="exitFullscreen('flashcards-fullscreen')">✕</button>
      <div class="flashcard-container">
        <h2>Flashcards</h2>
        <div class="progress-container" aria-label="Progression des flashcards">
          <div id="flashcard-progress" class="progress-bar" style="width: 0%;"></div>
        </div>
        <div class="flashcard" tabindex="0" onclick="flipFlashcard()" onkeydown="if(event.key==='Enter' || event.key===' ') flipFlashcard()">
          <div class="flashcard-inner">
            <div class="flashcard-front">
              <p id="flashcard-question">Question ou terme à apprendre</p>
            </div>
            <div class="flashcard-back">
              <p id="flashcard-answer">Réponse ou définition</p>
            </div>
          </div>
        </div>
        <div class="button-group">
          <button onclick="flashcardAnswer(false)">J'ai pas eu bon</button>
          <button onclick="flashcardAnswer(true)">J'ai eu bon</button>
        </div>
      </div>
    </div>
    <div id="quiz-fullscreen" class="fullscreen hidden" aria-label="Quiz mode">
      <button class="close-button" onclick="exitFullscreen('quiz-fullscreen')">✕</button>
      <div class="quiz-container">
        <h2>Quiz</h2>
        <div class="progress-container" aria-label="Progression du quiz">
          <div id="quiz-progress" class="progress-bar" style="width: 0%;"></div>
        </div>
        <p id="quiz-question" style="font-weight: 600; font-size: 1.4rem; min-height: 70px;"></p>
        <div id="quiz-options" role="list"></div>
        <div class="result-message" id="quiz-result-message"></div>
        <div class="button-group">
          <button id="quiz-next-btn" onclick="nextQuizQuestion()" disabled>Question Suivante</button>
        </div>
      </div>
    </div>
  </div>

  <div id="shareModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeShareModal()">&times;</span>
      <h2>Partager</h2>
      <p>Partagez cette session sur vos réseaux sociaux :</p>
      <div class="share-options">
        <a id="whatsapp-share" href="#" onclick="shareOnWhatsApp()" target="_blank">Partager sur WhatsApp</a>
        <a id="facebook-share" href="#" onclick="shareOnFacebook()" target="_blank">Partager sur Facebook</a>
      </div>
      <p>Ou copiez le JSON et le lien pour partager :</p>
      <textarea id="share-json" rows="10" style="width: 100%; margin-bottom: 10px;"></textarea>
      <input type="text" id="share-link" style="width: 100%; margin-bottom: 10px;" readonly>
      <button onclick="copyToClipboard()">Copier</button>
    </div>
  </div>

  <script>
    let flashcards = [];
    let quizQuestions = [];
    let currentFlashcardIndex = 0;
    let incorrectFlashcards = [];
    let currentQuizIndex = 0;
    let quizScore = 0;
    let quizAnswered = false;
    let flashcardChart, quizChart;

    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      updateShareLinks();
    }

    function updateShareLinks() {
      const isDarkMode = document.body.classList.contains('dark-mode');
      const whatsappShare = document.getElementById('whatsapp-share');
      const facebookShare = document.getElementById('facebook-share');

      const baseUrl = window.location.href;
      const themeParam = isDarkMode ? '?theme=dark' : '?theme=light';
      const shareUrl = baseUrl.includes('?') ? baseUrl.split('?')[0] + themeParam : baseUrl + themeParam;

      whatsappShare.href = `https://wa.me/?text=${encodeURIComponent(`Regardez cette session de flashcards et quiz : ${shareUrl}`)}`;
      facebookShare.href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
    }

    function initializeCharts() {
      const flashcardCtx = document.getElementById('flashcardChart').getContext('2d');
      flashcardChart = new Chart(flashcardCtx, {
        type: 'bar',
        data: {
          labels: ['Réussites', 'Échecs'],
          datasets: [{
            label: 'Flashcards',
            data: [0, 0],
            backgroundColor: [
              'rgba(40, 167, 69, 0.7)',
              'rgba(220, 53, 69, 0.7)'
            ],
            borderColor: [
              'rgba(40, 167, 69, 1)',
              'rgba(220, 53, 69, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          },
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });

      const quizCtx = document.getElementById('quizChart').getContext('2d');
      quizChart = new Chart(quizCtx, {
        type: 'pie',
        data: {
          labels: ['Réussites', 'Échecs'],
          datasets: [{
            label: 'Quiz',
            data: [0, 0],
            backgroundColor: [
              'rgba(40, 167, 69, 0.7)',
              'rgba(220, 53, 69, 0.7)'
            ],
            borderColor: [
              'rgba(40, 167, 69, 1)',
              'rgba(220, 53, 69, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }

    function updateFlashcardChart(successCount, failureCount) {
      flashcardChart.data.datasets[0].data = [successCount, failureCount];
      flashcardChart.update();
    }

    function updateQuizChart(successCount, failureCount) {
      quizChart.data.datasets[0].data = [successCount, failureCount];
      quizChart.update();
    }

    function exitFullscreen(elementId) {
      document.getElementById(elementId).classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');
    }

    function startSession() {
      try {
        const data = JSON.parse(document.getElementById('json-input').value);
        flashcards = Array.isArray(data.flashcards) ? data.flashcards : [];
        quizQuestions = Array.isArray(data.quiz) ? data.quiz : [];
        if (flashcards.length === 0 && quizQuestions.length === 0) {
          alert("Le JSON doit contenir au moins des flashcards ou des questions de quiz.");
          return;
        }
        document.getElementById('dashboard').classList.remove('hidden');
        initializeCharts();
      } catch (e) {
        alert("Erreur de format JSON : " + e.message);
      }
    }

    function showFlashcards() {
      if (flashcards.length === 0) {
        alert("Aucune flashcard disponible.");
        return;
      }
      document.getElementById('dashboard').classList.add('hidden');
      document.getElementById('flashcards-fullscreen').classList.remove('hidden');
      incorrectFlashcards = [];
      currentFlashcardIndex = 0;
      updateFlashcardProgress();
      showCurrentFlashcard();
    }

    function updateFlashcardProgress() {
      const progress = (currentFlashcardIndex / flashcards.length) * 100;
      document.getElementById('flashcard-progress').style.width = progress + '%';
    }

    function showCurrentFlashcard() {
      const flashcard = flashcards[currentFlashcardIndex];
      document.getElementById('flashcard-question').textContent = flashcard.recto;
      document.getElementById('flashcard-answer').textContent = flashcard.verso;
      const flashcardElement = document.querySelector('.flashcard');
      flashcardElement.classList.remove('flipped');
    }

    function flipFlashcard() {
      const flashcard = document.querySelector('.flashcard');
      flashcard.classList.toggle('flipped');
    }

    function flashcardAnswer(correct) {
      if (!correct) {
        incorrectFlashcards.push(flashcards[currentFlashcardIndex]);
      }
      currentFlashcardIndex++;
      if (currentFlashcardIndex < flashcards.length) {
        updateFlashcardProgress();
        showCurrentFlashcard();
      } else {
        if (incorrectFlashcards.length > 0) {
          updateFlashcardChart(flashcards.length - incorrectFlashcards.length, incorrectFlashcards.length);
          flashcards = [...incorrectFlashcards];
          incorrectFlashcards = [];
          currentFlashcardIndex = 0;
          alert("Vous allez revoir les flashcards que vous n'avez pas réussies.");
          updateFlashcardProgress();
          showCurrentFlashcard();
        } else {
          updateFlashcardChart(flashcards.length, 0);
          alert("Félicitations! Vous avez réussi toutes les flashcards.");
          document.getElementById('flashcard-stats').textContent = `Toutes les flashcards ont été réussies !`;
          exitFullscreen('flashcards-fullscreen');
        }
      }
    }

    function showQuiz() {
      if (quizQuestions.length === 0) {
        alert("Aucune question de quiz disponible.");
        return;
      }
      document.getElementById('dashboard').classList.add('hidden');
      document.getElementById('quiz-fullscreen').classList.remove('hidden');
      currentQuizIndex = 0;
      quizScore = 0;
      quizAnswered = false;
      updateQuizProgress();
      showCurrentQuizQuestion();
      document.getElementById('quiz-result-message').textContent = '';
      document.getElementById('quiz-next-btn').disabled = true;
    }

    function updateQuizProgress() {
      const progress = (currentQuizIndex / quizQuestions.length) * 100;
      document.getElementById('quiz-progress').style.width = progress + '%';
    }

    function showCurrentQuizQuestion() {
      quizAnswered = false;
      const quizQuestion = quizQuestions[currentQuizIndex];
      const questionEl = document.getElementById('quiz-question');
      const optionsEl = document.getElementById('quiz-options');
      const nextBtn = document.getElementById('quiz-next-btn');
      const resultMsg = document.getElementById('quiz-result-message');
      questionEl.textContent = quizQuestion.question;
      optionsEl.innerHTML = '';
      resultMsg.textContent = '';
      nextBtn.disabled = true;
      quizQuestion.options.forEach((option, index) => {
        const optBtn = document.createElement('button');
        optBtn.className = 'quiz-option';
        optBtn.textContent = option;
        optBtn.setAttribute('role', 'listitem');
        optBtn.onclick = () => handleQuizAnswer(index);
        optionsEl.appendChild(optBtn);
      });
    }

    function handleQuizAnswer(selectedIndex) {
      if (quizAnswered) return;
      quizAnswered = true;
      const quizQuestion = quizQuestions[currentQuizIndex];
      const optionsEl = document.getElementById('quiz-options');
      const nextBtn = document.getElementById('quiz-next-btn');
      const resultMsg = document.getElementById('quiz-result-message');
      Array.from(optionsEl.children).forEach((btn, idx) => {
        btn.disabled = true;
        if (idx === quizQuestion.correct) {
          btn.classList.add('correct');
        }
        if (idx === selectedIndex && idx !== quizQuestion.correct) {
          btn.classList.add('incorrect');
        }
      });
      if (selectedIndex === quizQuestion.correct) {
        quizScore++;
        resultMsg.textContent = "Bonne réponse !";
        resultMsg.style.color = 'var(--success-color)';
      } else {
        resultMsg.textContent = `Mauvaise réponse. La bonne réponse était : "${quizQuestion.options[quizQuestion.correct]}"`;
        resultMsg.style.color = 'var(--error-color)';
      }
      nextBtn.disabled = false;
    }

    function nextQuizQuestion() {
      currentQuizIndex++;
      if (currentQuizIndex < quizQuestions.length) {
        updateQuizProgress();
        showCurrentQuizQuestion();
      } else {
        showQuizResults();
      }
    }

    function showQuizResults() {
      const optionsEl = document.getElementById('quiz-options');
      const questionEl = document.getElementById('quiz-question');
      const nextBtn = document.getElementById('quiz-next-btn');
      const resultMsg = document.getElementById('quiz-result-message');
      optionsEl.innerHTML = '';
      questionEl.textContent = `Quiz terminé! Votre score : ${quizScore} / ${quizQuestions.length}`;
      resultMsg.textContent = '';
      nextBtn.disabled = false;
      nextBtn.textContent = 'Recommencer';
      nextBtn.onclick = () => {
        updateQuizChart(quizScore, quizQuestions.length - quizScore);
        document.getElementById('quiz-stats').textContent = `Votre score final est : ${quizScore} / ${quizQuestions.length}`;
        exitFullscreen('quiz-fullscreen');
        document.getElementById('dashboard').classList.remove('hidden');
      };
    }

    function showShareModal() {
      const jsonData = document.getElementById('json-input').value;
      document.getElementById('share-json').value = jsonData;
      document.getElementById('share-link').value = window.location.href;
      document.getElementById('shareModal').style.display = 'block';
      updateShareLinks();
    }

    function closeShareModal() {
      document.getElementById('shareModal').style.display = 'none';
    }

    function copyToClipboard() {
      const jsonText = document.getElementById('share-json');
      const linkText = document.getElementById('share-link');

      jsonText.select();
      document.execCommand('copy');
      linkText.select();
      document.execCommand('copy');

      alert('JSON et lien copiés dans le presse-papiers!');
    }

    function shareOnWhatsApp() {
      const jsonData = document.getElementById('json-input').value;
      const baseUrl = window.location.href;
      const isDarkMode = document.body.classList.contains('dark-mode');
      const themeParam = isDarkMode ? '?theme=dark' : '?theme=light';
      const shareUrl = baseUrl.includes('?') ? baseUrl.split('?')[0] + themeParam : baseUrl + themeParam;

      const url = `https://wa.me/?text=${encodeURIComponent(`Regardez cette session de flashcards et quiz : ${shareUrl}\n\nJSON: ${jsonData}`)}`;
      window.open(url, '_blank');
    }

    function shareOnFacebook() {
      const baseUrl = window.location.href;
      const isDarkMode = document.body.classList.contains('dark-mode');
      const themeParam = isDarkMode ? '?theme=dark' : '?theme=light';
      const shareUrl = baseUrl.includes('?') ? baseUrl.split('?')[0] + themeParam : baseUrl + themeParam;

      const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
      window.open(url, '_blank');
    }
  </script>
</body>
</html>
